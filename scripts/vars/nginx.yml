---
nginx_configs:
  upstream:
    - upstream app_server {
        server 127.0.0.1:8079 fail_timeout=0;
      }

nginx_sites:
  jenkins:
    - listen 8080
    - server_name jenkins.cibox
    - location / {
        auth_basic              "Restricted area";
        auth_basic_user_file    /var/www/.htpasswd;

        proxy_pass              http://127.0.0.1:8080;
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_read_timeout      90;

        if (!-f $request_filename) {
            proxy_pass http://app_server;
            break;
        }
      }

nginx_remove_sites:
  - default
